(function(P,M){typeof exports=="object"&&typeof module<"u"?M(exports):typeof define=="function"&&define.amd?define(["exports"],M):(P=typeof globalThis<"u"?globalThis:P||self,M(P.OSDTextLayer={}))})(this,function(P){"use strict";const M=e=>{var t;return(t=e.bodies.find(o=>o.purpose==="transcribing"))==null?void 0:t.value};var j=(e=>(e.POLYGON="POLYGON",e.RECTANGLE="RECTANGLE",e))(j||{});const re=(e,t)=>t,Se={area:e=>{const{points:t}=e.geometry;let o=0,n=t.length-1;for(let i=0;i<t.length;i++)o+=(t[n][0]+t[i][0])*(t[n][1]-t[i][1]),n=i;return Math.abs(.5*o)},intersects:(e,t,o)=>{const{points:n}=e.geometry;let i=!1;for(let a=0,r=n.length-1;a<n.length;r=a++){const s=n[a][0],l=n[a][1],f=n[r][0],c=n[r][1];l>o!=c>o&&t<(f-s)*(o-l)/(c-l)+s&&(i=!i)}return i}};re(j.POLYGON,Se);const Ee={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,o)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&o>=e.geometry.y&&o<=e.geometry.y+e.geometry.h};re(j.RECTANGLE,Ee),((e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,o)=>(o&=63,o<36?t+=o.toString(36):o<62?t+=(o-26).toString(36).toUpperCase():o>62?t+="-":t+="_",t),""))();const Le=e=>{const t=[];for(const o of e.querySelectorAll("String")){const n=o.getAttribute("ID"),i=o.getAttribute("CONTENT"),a=parseFloat(o.getAttribute("HPOS")),r=parseFloat(o.getAttribute("VPOS")),s=parseFloat(o.getAttribute("WIDTH")),l=parseFloat(o.getAttribute("HEIGHT")),f=a+s,c=r+l;t.push({id:n,bodies:[{id:n,annotation:n,purpose:"transcribing",value:i}],target:{annotation:n,selector:{type:j.RECTANGLE,geometry:{bounds:{minX:a,minY:r,maxX:f,maxY:c},x:a,y:r,w:s,h:l}}}})}return t},ve=e=>{const t=new DOMParser().parseFromString(e,"application/xml"),o=t.querySelector("Page"),n=[];for(const s of t.querySelectorAll("TextLine"))n.push(...Le(s));const i=o.getAttribute("ID"),a=parseFloat(o.getAttribute("HEIGHT")),r=parseFloat(o.getAttribute("WIDTH"));return{annotations:n,metadata:{id:i,height:a,width:r}}},xe=[];for(let e=0;e<256;++e)xe.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);function L(){}function se(e){return e()}function le(){return Object.create(null)}function G(e){e.forEach(se)}function ae(e){return typeof e=="function"}function B(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ae(e){return Object.keys(e).length===0}function v(e,t){e.appendChild(t)}function A(e,t,o){e.insertBefore(t,o||null)}function x(e){e.parentNode&&e.parentNode.removeChild(e)}function $(e,t){for(let o=0;o<e.length;o+=1)e[o]&&e[o].d(t)}function Y(e){return document.createElement(e)}function O(e){return document.createTextNode(e)}function V(){return O("")}function b(e,t,o){o==null?e.removeAttribute(t):e.getAttribute(t)!==o&&e.setAttribute(t,o)}function Pe(e){return Array.from(e.childNodes)}function ee(e,t){t=""+t,e.data!==t&&(e.data=t)}function w(e,t,o){e.classList[o?"add":"remove"](t)}let X;function D(e){X=e}function Ye(){if(!X)throw new Error("Function called outside component initialization");return X}function Oe(e){Ye().$$.on_mount.push(e)}const k=[],W=[];let I=[];const fe=[],Ne=Promise.resolve();let te=!1;function ze(){te||(te=!0,Ne.then(ce))}function ne(e){I.push(e)}const oe=new Set;let C=0;function ce(){if(C!==0)return;const e=X;do{try{for(;C<k.length;){const t=k[C];C++,D(t),Te(t.$$)}}catch(t){throw k.length=0,C=0,t}for(D(null),k.length=0,C=0;W.length;)W.pop()();for(let t=0;t<I.length;t+=1){const o=I[t];oe.has(o)||(oe.add(o),o())}I.length=0}while(k.length);for(;fe.length;)fe.pop()();te=!1,oe.clear(),D(e)}function Te(e){if(e.fragment!==null){e.update(),G(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ne)}}function ke(e){const t=[],o=[];I.forEach(n=>e.indexOf(n)===-1?t.push(n):o.push(n)),o.forEach(n=>n()),I=t}const q=new Set;let N;function R(){N={r:0,c:[],p:N}}function H(){N.r||G(N.c),N=N.p}function p(e,t){e&&e.i&&(q.delete(e),e.i(t))}function y(e,t,o,n){if(e&&e.o){if(q.has(e))return;q.add(e),N.c.push(()=>{q.delete(e),n&&(o&&e.d(1),n())}),e.o(t)}else n&&n()}function ie(e){e&&e.c()}function Z(e,t,o,n){const{fragment:i,after_update:a}=e.$$;i&&i.m(t,o),n||ne(()=>{const r=e.$$.on_mount.map(se).filter(ae);e.$$.on_destroy?e.$$.on_destroy.push(...r):G(r),e.$$.on_mount=[]}),a.forEach(ne)}function J(e,t){const o=e.$$;o.fragment!==null&&(ke(o.after_update),G(o.on_destroy),o.fragment&&o.fragment.d(t),o.on_destroy=o.fragment=null,o.ctx=[])}function Ie(e,t){e.$$.dirty[0]===-1&&(k.push(e),ze(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function K(e,t,o,n,i,a,r,s=[-1]){const l=X;D(e);const f=e.$$={fragment:null,ctx:[],props:a,update:L,not_equal:i,bound:le(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:le(),dirty:s,skip_bound:!1,root:t.target||l.$$.root};r&&r(f.root);let c=!1;if(f.ctx=o?o(e,t.props||{},(u,_,...g)=>{const h=g.length?g[0]:_;return f.ctx&&i(f.ctx[u],f.ctx[u]=h)&&(!f.skip_bound&&f.bound[u]&&f.bound[u](h),c&&Ie(e,u)),_}):[],f.update(),c=!0,G(f.before_update),f.fragment=n?n(f.ctx):!1,t.target){if(t.hydrate){const u=Pe(t.target);f.fragment&&f.fragment.l(u),u.forEach(x)}else f.fragment&&f.fragment.c();t.intro&&p(e.$$.fragment),Z(e,t.target,t.anchor,t.customElement),ce()}D(l)}class Q{$destroy(){J(this,1),this.$destroy=L}$on(t,o){if(!ae(o))return L;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(o),()=>{const i=n.indexOf(o);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!Ae(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Ce(e){let t,o,n=e[1].label(e[0])+"",i,a,r;return{c(){t=Y("div"),o=Y("span"),i=O(n),a=O(" "),b(t,"class","annotation"),b(t,"style",r=`left:${e[8]}px; top:${e[7]}px; width: ${e[4]}px; height: ${e[3]}px; transform: scale(${e[6]}, ${e[5]})`)},m(s,l){A(s,t,l),v(t,o),v(o,i),e[10](o),v(t,a)},p(s,[l]){l&3&&n!==(n=s[1].label(s[0])+"")&&ee(i,n),l&504&&r!==(r=`left:${s[8]}px; top:${s[7]}px; width: ${s[4]}px; height: ${s[3]}px; transform: scale(${s[6]}, ${s[5]})`)&&b(t,"style",r)},i:L,o:L,d(s){s&&x(t),e[10](null)}}}function Me(e,t,o){let n,i,a,r,s,l,f,c,{annotation:u}=t,{opts:_}=t;function g(h){W[h?"unshift":"push"](()=>{c=h,o(2,c)})}return e.$$set=h=>{"annotation"in h&&o(0,u=h.annotation),"opts"in h&&o(1,_=h.opts)},e.$$.update=()=>{e.$$.dirty&1&&o(9,n=u.target.selector.geometry.bounds),e.$$.dirty&512&&o(8,i=n.minX),e.$$.dirty&512&&o(7,a=n.minY),e.$$.dirty&512&&o(4,r=n.maxX-n.minX),e.$$.dirty&512&&o(3,s=n.maxY-n.minY),e.$$.dirty&20&&o(6,l=c?r/c.offsetWidth:1),e.$$.dirty&12&&o(5,f=c?s/c.offsetHeight:1)},[u,_,c,s,r,f,l,a,i,n,g]}class Ge extends Q{constructor(t){super(),K(this,t,Me,Ce,B,{annotation:0,opts:1})}}function Xe(e){let t,o,n=e[1].label(e[0])+"",i,a,r;return{c(){t=Y("div"),o=Y("span"),i=O(n),a=O(" "),b(t,"class","annotation"),b(t,"style",r=e[4](e[3]))},m(s,l){A(s,t,l),v(t,o),v(o,i),e[5](o),v(t,a)},p(s,[l]){l&3&&n!==(n=s[1].label(s[0])+"")&&ee(i,n),l&8&&r!==(r=s[4](s[3]))&&b(t,"style",r)},i:L,o:L,d(s){s&&x(t),e[5](null)}}}function De(e,t,o){let n,i,a,{annotation:r}=t,{opts:s}=t;const l=c=>{const u=s.offsetX||0,_=s.offsetY||0;if(s.position==="center"){const g=n.maxX-n.minX,h=n.minX+g/2-c[0]/2,d=n.maxY-n.minY,E=n.minY+d/2-c[1]/2;return`left:${h+u}px; top:${E+_}px;`}else return s.position==="topleft"?`left:${n.minX+u}px; top:${n.minY+_}px;`:`left:${n.minX+u}px; top:${n.maxY+_}px;`};function f(c){W[c?"unshift":"push"](()=>{a=c,o(2,a)})}return e.$$set=c=>{"annotation"in c&&o(0,r=c.annotation),"opts"in c&&o(1,s=c.opts)},e.$$.update=()=>{e.$$.dirty&1&&(n=r.target.selector.geometry.bounds),e.$$.dirty&4&&o(3,i=a?[a.offsetWidth,a.offsetHeight]:[0,0])},[r,s,a,i,l,f]}class Re extends Q{constructor(t){super(),K(this,t,De,Xe,B,{annotation:0,opts:1})}}function He(e){let t,o,n=e[1].label(e[0])+"",i,a,r;return{c(){t=Y("div"),o=Y("span"),i=O(n),a=O(" "),b(t,"class","annotation"),b(t,"style",r=e[5](e[4],e[3],e[2]))},m(s,l){A(s,t,l),v(t,o),v(o,i),v(t,a)},p(s,[l]){l&3&&n!==(n=s[1].label(s[0])+"")&&ee(i,n),l&28&&r!==(r=s[5](s[4],s[3],s[2]))&&b(t,"style",r)},i:L,o:L,d(s){s&&x(t)}}}function Fe(e,t,o){let n,i,a,{annotation:r}=t,{opts:s}=t,{scale:l}=t,{imageSize:f}=t;const c=(u,_,g)=>{const h=(s.offsetX||0)/g,d=(s.offsetY||0)/g;if(s.position==="topleft"){const E=f[1]-_;return`left:${u+h}px; bottom:${E}px; transform: scale(${1/g})`}else return`left:${u+h}px; top:${_+d}px; transform: scale(${1/g})`};return e.$$set=u=>{"annotation"in u&&o(0,r=u.annotation),"opts"in u&&o(1,s=u.opts),"scale"in u&&o(2,l=u.scale),"imageSize"in u&&o(6,f=u.imageSize)},e.$$.update=()=>{e.$$.dirty&1&&o(7,n=r.target.selector.geometry.bounds),e.$$.dirty&128&&o(4,i=n.minX),e.$$.dirty&130&&o(3,a=s.position==="topleft"?n.minY:n.maxY)},[r,s,l,a,i,c,f,n]}class Ue extends Q{constructor(t){super(),K(this,t,Fe,He,B,{annotation:0,opts:1,scale:2,imageSize:6})}}var z=(e=>(e.POLYGON="POLYGON",e.RECTANGLE="RECTANGLE",e))(z||{});const ue=(e,t)=>t,je={area:e=>{const{points:t}=e.geometry;let o=0,n=t.length-1;for(let i=0;i<t.length;i++)o+=(t[n][0]+t[i][0])*(t[n][1]-t[i][1]),n=i;return Math.abs(.5*o)},intersects:(e,t,o)=>{const{points:n}=e.geometry;let i=!1;for(let a=0,r=n.length-1;a<n.length;r=a++){const s=n[a][0],l=n[a][1],f=n[r][0],c=n[r][1];l>o!=c>o&&t<(f-s)*(o-l)/(c-l)+s&&(i=!i)}return i}};ue(z.POLYGON,je);const Be={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,o)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&o>=e.geometry.y&&o<=e.geometry.y+e.geometry.h};ue(z.RECTANGLE,Be),((e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,o)=>(o&=63,o<36?t+=o.toString(36):o<62?t+=(o-26).toString(36).toUpperCase():o>62?t+="-":t+="_",t),""))();const de=e=>new Promise(t=>{var o;if((o=e.world.getItemAt(0))!=null&&o.source){const{x:n,y:i}=e.world.getItemAt(0).source.dimensions;t({width:n,height:i})}else{const n=()=>{const{x:i,y:a}=e.world.getItemAt(0).source.dimensions;e.removeHandler("open",n),t({width:i,height:a})};e.addHandler("open",n)}}),Ve=(e,t,o)=>{const{bounds:n}=e.geometry,i=n.minX*t,a=n.minY*o,r=n.maxX*t,s=n.maxY*o;return e.type===z.RECTANGLE?{type:z.RECTANGLE,geometry:{bounds:{minX:i,minY:a,maxX:r,maxY:s},x:i,y:a,w:r-i,h:s-a}}:e.type===z.POLYGON?{type:z.POLYGON,geometry:{bounds:{minX:i,minY:a,maxX:r,maxY:s},points:e.geometry.points.map(([l,f])=>[l*t,f*o])}}:(console.error("Unsupported shape type",e),e)},We=(e,t,o)=>{const n=t.width,i=t.height,a=o.width,r=o.height;if(n&&i){const s=a/n,l=r/i;return s===1&&l==1?e:(console.log("[TextLayerExtension] Page and image are different size - scaling annotations"),e.map(f=>({...f,target:{...f.target,selector:Ve(f.target.selector,s,l)}})))}else return console.warn("[TextLayerExtension] Cannot scale annotations without page dimensions"),e};function ge(e,t,o){const n=e.slice();return n[12]=t[o],n}function he(e,t,o){const n=e.slice();return n[12]=t[o],n}function me(e,t,o){const n=e.slice();return n[12]=t[o],n}function pe(e){let t,o,n,i,a;const r=[Je,Ze,qe],s=[];function l(f,c){return f[0].mode==="fixedScreenSize"||!f[0].mode?0:f[0].mode==="fixedPageSize"?1:f[0].mode==="fillBounds"?2:-1}return~(o=l(e))&&(n=s[o]=r[o](e)),{c(){t=Y("div"),n&&n.c(),b(t,"style",i=`transform:${e[3]}; width: ${e[6]}px; height: ${e[7]}px`),b(t,"class","a9s-annotationlayer a9s-osd-textlayer"),w(t,"fixed-screen-size",e[0].mode==="fixedScreenSize"||!e[0].mode),w(t,"fixed-page-size",e[0].mode==="fixedPageSize"),w(t,"fill-bounds",e[0].mode==="fillBounds"),w(t,"bottomleft",e[0].position!=="topleft"),w(t,"topleft",e[0].position==="topleft"),w(t,"pointer-events",e[2])},m(f,c){A(f,t,c),~o&&s[o].m(t,null),a=!0},p(f,c){let u=o;o=l(f),o===u?~o&&s[o].p(f,c):(n&&(R(),y(s[u],1,1,()=>{s[u]=null}),H()),~o?(n=s[o],n?n.p(f,c):(n=s[o]=r[o](f),n.c()),p(n,1),n.m(t,null)):n=null),(!a||c&200&&i!==(i=`transform:${f[3]}; width: ${f[6]}px; height: ${f[7]}px`))&&b(t,"style",i),(!a||c&1)&&w(t,"fixed-screen-size",f[0].mode==="fixedScreenSize"||!f[0].mode),(!a||c&1)&&w(t,"fixed-page-size",f[0].mode==="fixedPageSize"),(!a||c&1)&&w(t,"fill-bounds",f[0].mode==="fillBounds"),(!a||c&1)&&w(t,"bottomleft",f[0].position!=="topleft"),(!a||c&1)&&w(t,"topleft",f[0].position==="topleft"),(!a||c&4)&&w(t,"pointer-events",f[2])},i(f){a||(p(n),a=!0)},o(f){y(n),a=!1},d(f){f&&x(t),~o&&s[o].d()}}}function qe(e){let t,o,n=e[5],i=[];for(let r=0;r<n.length;r+=1)i[r]=_e(ge(e,n,r));const a=r=>y(i[r],1,1,()=>{i[r]=null});return{c(){for(let r=0;r<i.length;r+=1)i[r].c();t=V()},m(r,s){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(r,s);A(r,t,s),o=!0},p(r,s){if(s&33){n=r[5];let l;for(l=0;l<n.length;l+=1){const f=ge(r,n,l);i[l]?(i[l].p(f,s),p(i[l],1)):(i[l]=_e(f),i[l].c(),p(i[l],1),i[l].m(t.parentNode,t))}for(R(),l=n.length;l<i.length;l+=1)a(l);H()}},i(r){if(!o){for(let s=0;s<n.length;s+=1)p(i[s]);o=!0}},o(r){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)y(i[s]);o=!1},d(r){$(i,r),r&&x(t)}}}function Ze(e){let t,o,n=e[5],i=[];for(let r=0;r<n.length;r+=1)i[r]=ye(he(e,n,r));const a=r=>y(i[r],1,1,()=>{i[r]=null});return{c(){for(let r=0;r<i.length;r+=1)i[r].c();t=V()},m(r,s){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(r,s);A(r,t,s),o=!0},p(r,s){if(s&33){n=r[5];let l;for(l=0;l<n.length;l+=1){const f=he(r,n,l);i[l]?(i[l].p(f,s),p(i[l],1)):(i[l]=ye(f),i[l].c(),p(i[l],1),i[l].m(t.parentNode,t))}for(R(),l=n.length;l<i.length;l+=1)a(l);H()}},i(r){if(!o){for(let s=0;s<n.length;s+=1)p(i[s]);o=!0}},o(r){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)y(i[s]);o=!1},d(r){$(i,r),r&&x(t)}}}function Je(e){let t,o,n=e[5],i=[];for(let r=0;r<n.length;r+=1)i[r]=be(me(e,n,r));const a=r=>y(i[r],1,1,()=>{i[r]=null});return{c(){for(let r=0;r<i.length;r+=1)i[r].c();t=V()},m(r,s){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(r,s);A(r,t,s),o=!0},p(r,s){if(s&241){n=r[5];let l;for(l=0;l<n.length;l+=1){const f=me(r,n,l);i[l]?(i[l].p(f,s),p(i[l],1)):(i[l]=be(f),i[l].c(),p(i[l],1),i[l].m(t.parentNode,t))}for(R(),l=n.length;l<i.length;l+=1)a(l);H()}},i(r){if(!o){for(let s=0;s<n.length;s+=1)p(i[s]);o=!0}},o(r){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)y(i[s]);o=!1},d(r){$(i,r),r&&x(t)}}}function _e(e){let t,o;return t=new Ge({props:{annotation:e[12],opts:e[0]}}),{c(){ie(t.$$.fragment)},m(n,i){Z(t,n,i),o=!0},p(n,i){const a={};i&32&&(a.annotation=n[12]),i&1&&(a.opts=n[0]),t.$set(a)},i(n){o||(p(t.$$.fragment,n),o=!0)},o(n){y(t.$$.fragment,n),o=!1},d(n){J(t,n)}}}function ye(e){let t,o;return t=new Re({props:{annotation:e[12],opts:e[0]}}),{c(){ie(t.$$.fragment)},m(n,i){Z(t,n,i),o=!0},p(n,i){const a={};i&32&&(a.annotation=n[12]),i&1&&(a.opts=n[0]),t.$set(a)},i(n){o||(p(t.$$.fragment,n),o=!0)},o(n){y(t.$$.fragment,n),o=!1},d(n){J(t,n)}}}function be(e){let t,o;return t=new Ue({props:{annotation:e[12],opts:e[0],imageSize:[e[6],e[7]],scale:e[4]}}),{c(){ie(t.$$.fragment)},m(n,i){Z(t,n,i),o=!0},p(n,i){const a={};i&32&&(a.annotation=n[12]),i&1&&(a.opts=n[0]),i&192&&(a.imageSize=[n[6],n[7]]),i&16&&(a.scale=n[4]),t.$set(a)},i(n){o||(p(t.$$.fragment,n),o=!0)},o(n){y(t.$$.fragment,n),o=!1},d(n){J(t,n)}}}function Ke(e){let t,o,n=e[1]&&pe(e);return{c(){n&&n.c(),t=V()},m(i,a){n&&n.m(i,a),A(i,t,a),o=!0},p(i,[a]){i[1]?n?(n.p(i,a),a&2&&p(n,1)):(n=pe(i),n.c(),p(n,1),n.m(t.parentNode,t)):n&&(R(),y(n,1,1,()=>{n=null}),H())},i(i){o||(p(n),o=!0)},o(i){y(n),o=!1},d(i){n&&n.d(i),i&&x(t)}}}function Qe(e,t,o){let{state:n}=t,{viewer:i}=t,{opts:a}=t,{visible:r=!0}=t,{captureEvents:s=!1}=t;const{store:l}=n;let f,c,u=[],_,g;const h=()=>{const d=i.viewport.viewportToImageRectangle(i.viewport.getBounds(!0)),E=i.viewport.getContainerSize().x,S=i.viewport.getZoom(!0);o(4,c=S*E/i.world.getContentFactor());let m=Math.PI*i.viewport.getRotation(!0)/180;m<0&&(m+=2*Math.PI),m>2*Math.PI&&(m-=2*Math.PI);const T=-d.x*c,we=-d.y*c;let F,U;m>0&&m<=Math.PI/2?(F=d.height*c,U=0):m>Math.PI/2&&m<=Math.PI?(F=d.width*c,U=d.height*c):m>Math.PI&&m<=Math.PI*1.5?(F=0,U=d.width*c):(F=0,U=0);const tt=Math.round(100*(F+T*Math.cos(m)-we*Math.sin(m)))/100,nt=Math.round(100*(U+T*Math.sin(m)+we*Math.cos(m)))/100;o(3,f=`translate(${tt}px, ${nt}px) rotate(${m}rad) scale(${c})`)};return Oe(()=>{de(i).then(S=>{o(6,_=S.width),o(7,g=S.height)}),i.addHandler("update-viewport",h);const d=S=>{o(5,u=S.state),h()};l.observe(d);const E=S=>{const m=document.getSelection().toString(),T=S.clipboardData||window.clipboardData;T.setData("text/plain",m),T.setData("text/html",m),S.preventDefault()};return document.addEventListener("copy",E),()=>{i.removeHandler("update-viewport",h),l.unobserve(d),document.removeEventListener("copy",E)}}),e.$$set=d=>{"state"in d&&o(8,n=d.state),"viewer"in d&&o(9,i=d.viewer),"opts"in d&&o(0,a=d.opts),"visible"in d&&o(1,r=d.visible),"captureEvents"in d&&o(2,s=d.captureEvents)},[a,r,s,f,c,u,_,g,n,i]}class $e extends Q{constructor(t){super(),K(this,t,Qe,Ke,B,{state:8,viewer:9,opts:0,visible:1,captureEvents:2})}}const rt="",et=(e,t)=>{const{viewer:o,state:n}=e;let i=t.initialVisibility===void 0?!0:t.initialVisibility,a=!1;const r=new $e({target:o.element.querySelector(".openseadragon-canvas"),props:{state:n,viewer:o,opts:t,visible:i}});return{isLocked:()=>a,isVisible:()=>i,loadOCR:(g,h="ALTO")=>fetch(g).then(d=>d.text()).then(d=>{const{annotations:E,metadata:S}=ve(d);de(o).then(m=>{const T=We(E,S,m);e.setAnnotations(T)})}),setLocked:g=>{a=g,o.setMouseNavEnabled(!g),r.$$set({captureEvents:g})},setVisible:g=>{i=g,r.$$set({visible:g})},unmount:()=>r.$destroy()}};P.mountExtension=et,P.transcriptionLabel=M,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=annotorious-openseadragon-textlayer.js.map
